<div class="login-container">
  <div class="login-box">
    <h1>{{ isRegisterMode ? 'Créer un compte' : 'Se connecter' }}</h1>

    <!-- Messages d'erreur -->
    <div *ngIf="(error$ | async) as error" class="alert alert-danger">
      {{ error }}
    </div>

    <!-- Formulaire de connexion -->
    <form [formGroup]="loginForm" *ngIf="!isRegisterMode" (ngSubmit)="onLogin()">
      <div class="form-group">
        <label for="login-email">Email</label>
        <input
          id="login-email"
          type="email"
          class="form-control"
          formControlName="email"
          placeholder="Entrez votre email"
        />
        <div *ngIf="loginForm.get('email')?.hasError('required') && loginForm.get('email')?.touched" class="error-message">
          L'email est requis
        </div>
        <div *ngIf="loginForm.get('email')?.hasError('email') && loginForm.get('email')?.touched" class="error-message">
          Email invalide
        </div>
      </div>

      <div class="form-group">
        <label for="login-password">Mot de passe</label>
        <input
          id="login-password"
          type="password"
          class="form-control"
          formControlName="password"
          placeholder="Entrez votre mot de passe"
        />
        <div *ngIf="loginForm.get('password')?.hasError('required') && loginForm.get('password')?.touched" class="error-message">
          Le mot de passe est requis
        </div>
      </div>

      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="!loginForm.valid || (loading$ | async)"
      >
        {{ (loading$ | async) ? 'Connexion en cours...' : 'Se connecter' }}
      </button>

      <p class="toggle-mode">
        Pas encore de compte?
        <a (click)="toggleMode()" style="cursor: pointer; color: #007bff;">S'enregistrer</a>
      </p>
    </form>

    <!-- Formulaire d'enregistrement -->
    <form [formGroup]="registerForm" *ngIf="isRegisterMode" (ngSubmit)="onRegister()">
      <div class="form-group">
        <label for="register-name">Nom</label>
        <input
          id="register-name"
          type="text"
          class="form-control"
          formControlName="name"
          placeholder="Entrez votre nom"
        />
        <div *ngIf="registerForm.get('name')?.hasError('required') && registerForm.get('name')?.touched" class="error-message">
          Le nom est requis
        </div>
      </div>

      <div class="form-group">
        <label for="register-email">Email</label>
        <input
          id="register-email"
          type="email"
          class="form-control"
          formControlName="email"
          placeholder="Entrez votre email"
        />
        <div *ngIf="registerForm.get('email')?.hasError('required') && registerForm.get('email')?.touched" class="error-message">
          L'email est requis
        </div>
      </div>

      <div class="form-group">
        <label for="register-password">Mot de passe</label>
        <input
          id="register-password"
          type="password"
          class="form-control"
          formControlName="password"
          placeholder="Entrez un mot de passe (min 6 caractères)"
        />
        <div *ngIf="registerForm.get('password')?.hasError('required') && registerForm.get('password')?.touched" class="error-message">
          Le mot de passe est requis
        </div>
      </div>

      <div class="form-group">
        <label for="register-confirm-password">Confirmer le mot de passe</label>
        <input
          id="register-confirm-password"
          type="password"
          class="form-control"
          formControlName="confirmPassword"
          placeholder="Confirmez le mot de passe"
        />
        <div *ngIf="registerForm.hasError('passwordMismatch') && registerForm.get('confirmPassword')?.touched" class="error-message">
          Les mots de passe ne correspondent pas
        </div>
      </div>

      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="!registerForm.valid || (loading$ | async)"
      >
        {{ (loading$ | async) ? 'Enregistrement en cours...' : 'S\'enregistrer' }}
      </button>

      <p class="toggle-mode">
        Vous avez déjà un compte?
        <a (click)="toggleMode()" style="cursor: pointer; color: #007bff;">Se connecter</a>
      </p>
    </form>
  </div>
</div>
